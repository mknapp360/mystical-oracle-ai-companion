-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.birth_charts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL UNIQUE,
  birth_date_time timestamp with time zone NOT NULL,
  birth_city text NOT NULL,
  birth_country text NOT NULL,
  birth_latitude numeric NOT NULL,
  birth_longitude numeric NOT NULL,
  birth_timezone text NOT NULL,
  natal_planets jsonb NOT NULL,
  ascendant_sign text NOT NULL,
  ascendant_degree numeric NOT NULL,
  midheaven_sign text NOT NULL,
  midheaven_degree numeric NOT NULL,
  house_cusps ARRAY NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  updated_at timestamp with time zone NOT NULL DEFAULT now(),
  natal_aspects jsonb DEFAULT '[]'::jsonb,
  planetary_positions jsonb DEFAULT '{}'::jsonb,
  CONSTRAINT birth_charts_pkey PRIMARY KEY (id),
  CONSTRAINT birth_charts_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id)
);
CREATE TABLE public.readings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid DEFAULT auth.uid(),
  question text DEFAULT ''::text,
  cards jsonb,
  interpretation text DEFAULT ''::text,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT readings_pkey PRIMARY KEY (id)
);
CREATE TABLE public.transit_readings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id uuid NOT NULL,
  birth_chart_id uuid NOT NULL,
  transit_date timestamp with time zone NOT NULL DEFAULT now(),
  transit_planets jsonb NOT NULL,
  transit_aspects jsonb NOT NULL,
  personalized_message jsonb NOT NULL,
  created_at timestamp with time zone NOT NULL DEFAULT now(),
  CONSTRAINT transit_readings_pkey PRIMARY KEY (id),
  CONSTRAINT transit_readings_user_id_fkey FOREIGN KEY (user_id) REFERENCES auth.users(id),
  CONSTRAINT transit_readings_birth_chart_id_fkey FOREIGN KEY (birth_chart_id) REFERENCES public.birth_charts(id)
);